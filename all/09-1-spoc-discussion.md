# 文件系统(lec 21) spoc 思考题

## 个人思考题
### 文件系统和文件 
 1. 文件系统的功能是什么？

>  负责数据持久保存，功能是数据存储和访问

>  具体功能：文件分配、文件管理、数据可靠和安全

 1. 什么是文件？

>  文件系统中具有符号名的基本数据单位。

### 文件描述符
 1. 打开文件时，文件系统要维护哪些信息？

>  文件指针、打开文件计数、访问权限、文件位置和数据缓存

 1. 文件系统的基本数据访问单位是什么？这对文件系统有什么影响？
 1. 文件的索引访问有什么特点？如何优化索引访问的速度？

### 目录、文件别名和文件系统种类
 1. 什么是目录？

>  由文件索引项组成的特殊文件。

 1. 目录的组织结构是什么样的？

>  树结构、有向图

 1. 目录操作有哪些种类？
 1. 什么是文件别名？软链接和硬链接有什么区别？
 1. 路径遍历的流程是什么样的？如何优化路径遍历？
 1. 什么是文件挂载？
 1. 为什么会存在大量的文件类型？

### 虚拟文件系统 
 1. 虚拟文件系统的功能是什么？

>  对上对下的接口、高效访问实现

 1. 文件卷控制块、文件控制块和目录项的相互关系是什么？
 1. 可以把文件控制块放到目录项中吗？这样做有什么优缺点？


### 文件缓存和打开文件
 1. 文件缓存和页缓存有什么区别和联系？
 1. 为什么要同时维护进程的打开文件表和操作系统的打开文件表？这两个打开文件表有什么区别和联系？为什么没有线程的打开文件表？
 
### 文件分配
 1. 文件分配的三种方式是如何组织文件数据块的？各有什么特征？
 1. UFS多级索引分配是如何组织文件数据块的位置信息的？

### 空闲空间管理和冗余磁盘阵列RAID
 1. 硬盘空闲空间组织和文件分配有什么异同？
 1. RAID-0、1、4和5分别是如何组织磁盘数据块的？各有什么特征？

## 小组思考题
 1. (spoc)完成Simple File System的功能，支持应用程序的一般文件操作。具体帮助和要求信息请看[sfs-homework](https://github.com/chyyuu/ucore_lab/blob/master/related_info/lab8/sfs-homework.md)

代码在[这里](https://github.com/december/os_data/blob/master/sfs.py)查看。

 1. (spoc)FAT、UFS、YAFFS、NTFS这几种文件系统中选一种，分析它的文件卷结构、目录结构、文件分配方式，以及它的变种。
  wikipedia上的文件系统列表参考
  - http://en.wikipedia.org/wiki/List_of_file_systems
  - http://en.wikipedia.org/wiki/File_system
  - http://en.wikipedia.org/wiki/List_of_file_systems

  请同学们依据自己的选择，在下面链接处回复分析结果。
  - [https://piazza.com/class/i5j09fnsl7k5x0?cid=416 FAT文件系统分析]
  - [https://piazza.com/class/i5j09fnsl7k5x0?cid=417 NTFS文件系统分析]
  - [https://piazza.com/class/i5j09fnsl7k5x0?cid=418 UFS文件系统分析]
  - [https://piazza.com/class/i5j09fnsl7k5x0?cid=419 ZFS文件系统分析]
  - [https://piazza.com/class/i5j09fnsl7k5x0?cid=420 YAFFS文件系统分析]

文件卷结构：主启动区＋文件分配表1＋文件分配表2＋根目录＋数据区域。具体解释如下：

```
主启动区：即保留扇区，位于最开始的位置。第一个保留扇区是引导区（分区启动记录），包括一个称为基本输入输出参数块的区域（包括一些基本的文件系统信息尤其是它的类型和其它指向其它扇区的指针），通常包括操作系统的启动调用代码。保留扇区的总数记录在引导扇区中的一个参数中。引导扇区中的重要信息可以被DOS和OS/2中称为驱动器参数块的操作系统结构访问。

文件分配表：即FAT区域，出于系统冗余考虑包含有两份文件分配表。它是分区信息的映射表，指示簇是如何存储的。

根目录：存储文件和目录信息的目录表，在FAT32下已经可以存在分区中的任何位置。

数据区域：实际的文件和目录数据存储的区域，占据了分区的绝大部分。通过简单地在FAT中添加文件链接的个数可以通过分配空簇的方式直接增加文件大小和子目录个数，每个簇只能被一个文件占有，未被占满的簇剩余空间将被浪费掉。
```

目录结构：目录表是一个表示目录的特殊类型文件（现今通常称为文件夹）。它里面保存的每个文件或目录使用条目表示。每个条目记录名字、扩展名、属性（档案、目录、隐藏、只读、系统和卷）、创建的日期和时间、文件／目录数据第一个簇的地址、大小。具体格式如下：

```
字节偏移		长度		描述

0x00		8		DOS文件名（附加空格）
0x08		3		DOS文件扩展名（空格补齐）
0x0b		1		文件属性
0x0c		1		保留，NT使用
0x0d		1		创建时间，最小时间分辨率：10ms单位，数值从0到199。
0x0e		2		创建时间。15-11、10-5、4-0分别表示小时、分钟和秒。
0x10		2		创建日期。15-9、8-5、4-0分别表示年、月和日。
0x12		2		最近访问日期；参见偏移0x10处的描述。
0x14		2		FAT12和FAT16中的EA-Index（OS/2和NT使用），FAT32中第一个簇的两个高字节
0x16		2		最后更改时间；参见偏移0x0e处的描述。
0x18		2		最后更改日期； 参见偏移0x10处的描述。
0x1a		2		FAT12和FAT16中的第一个簇。FAT32中第一个簇的两个低字节。
0x1c		4		文件大小
```

文件分配方式：FAT以簇基本单位分配文件空间。一个分区分成同等大小的簇，也就是连续空间的小块。簇的大小随着FAT文件系统的类型以及分区大小而不同，典型的簇大小介于2KB到32KB之间。每个文件根据它的大小可能占有一个或者多个簇（每个簇的剩余空间将被浪费掉，即碎片）。每个文件就由这些组织成单向链表的“簇链”所表示。这些链并不一定磁盘上连续存储，而经常是在整个数据区域零散的储存。文件分配表是映射到分区每个簇的条目列表，每个条目记录下面五种信息中的一种：

```
链中下一个簇的地址
一个特殊的簇链结束符（EOC，End Of Cluster-chain，或称End Of Chain）符号指示链的结束
一个特殊的符号标示坏簇
一个特殊的符号标示保留簇
0来表示空闲簇
```

通过这些信息就能完成对簇的寻址，从而完成对文件的访问。
